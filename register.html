<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SettleMe â€“ Registro</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header>
    <div class="nav">
      <!-- Logo de la compaÃ±Ã­a en lugar del texto de marca -->
      <img id="companyLogo" class="company-logo" src="" alt="Logo">
      <ul>
        <li><button id="toggleDark" class="dark-toggle" title="Alternar modo oscuro">ðŸŒ™</button></li>
      </ul>
    </div>
  </header>
  <main class="container">
    <div class="card">
      <h2>Registro de empleado</h2>
      <div id="registerMessage" class="message" style="display:none;"></div>
      <form id="registerForm">
        <!-- Foto de perfil con vista previa -->
        <div class="profile-picture-wrapper">
          <div class="profile-picture" id="profilePicture">
            <span class="placeholder">ðŸ‘¤</span>
            <img id="profilePreview" alt="Foto de perfil" />
          </div>
          <!-- Input oculto para seleccionar la imagen -->
          <input type="file" id="photo" accept="image/*" style="display:none;" required>
        </div>
        <div class="form-group">
          <label for="firstName">Nombre</label>
          <input type="text" id="firstName" required>
        </div>
        <div class="form-group">
          <label for="middleName">Segundo nombre</label>
          <input type="text" id="middleName">
        </div>
        <div class="form-group">
          <label for="lastName">Apellidos</label>
          <input type="text" id="lastName" required>
        </div>
        <div class="form-group">
          <label for="phone">TelÃ©fono</label>
          <input type="tel" id="phone" required>
        </div>
        <div class="form-group">
          <label for="email">Correo electrÃ³nico</label>
          <input type="email" id="email" required>
        </div>
        <div class="form-group">
          <label for="password">ContraseÃ±a</label>
          <input type="password" id="password" required>
        </div>
        <div class="form-group">
          <label for="govId">IdentificaciÃ³n gubernamental / Licencia</label>
          <input type="file" id="govId" accept="image/*" required>
        </div>
        <div class="form-group">
          <label for="ssn">NÃºmero de seguro social</label>
          <input type="text" id="ssn" required>
        </div>
        <div class="form-group">
          <label for="payType">Tipo de pago</label>
          <select id="payType" required>
            <option value="hora">Por hora</option>
            <option value="dia">Por dÃ­a</option>
            <option value="salario">Salario mensual</option>
          </select>
        </div>
        <div class="form-group">
          <label for="payRate">Tarifa/Pago</label>
          <input type="number" id="payRate" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="isAdmin">
            <input type="checkbox" id="isAdmin"> Â¿Es administrador?
          </label>
        </div>
        <button type="submit">Registrar</button>
      </form>
      <p>Â¿Ya tienes cuenta? <a href="index.html" class="action-link">Inicia sesiÃ³n</a></p>
    </div>
  </main>
  <script src="js/app.js"></script>
  <!-- Fondo neuronal animado sin dependencias externas -->
  <script src="js/background.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      initTheme();
      // Cargar logo de la compaÃ±Ã­a si existe
      try {
        const logo = await getCompanyLogo();
        if (logo) {
          const logoEl = document.getElementById('companyLogo');
          if (logoEl) logoEl.src = logo;
        }
      } catch (e) {
        console.error('Error al cargar logo', e);
      }
      // Vista previa de la foto de perfil
      const profilePicture = document.getElementById('profilePicture');
      const photoInput = document.getElementById('photo');
      const previewImg = document.getElementById('profilePreview');
      const placeholder = profilePicture.querySelector('.placeholder');
      // Al hacer clic en el cÃ­rculo de la foto, disparar el input de archivo
      profilePicture.addEventListener('click', () => {
        photoInput.click();
      });
      // Cuando se selecciona una imagen, mostrarla en el preview
      photoInput.addEventListener('change', () => {
        const file = photoInput.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            previewImg.src = e.target.result;
            previewImg.style.display = 'block';
            placeholder.style.display = 'none';
          };
          reader.readAsDataURL(file);
        }
      });
      document.getElementById('registerForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        const messageEl = document.getElementById('registerMessage');
        const userData = {};
        // Obtener archivos y convertir a base64
        const photoFile = document.getElementById('photo').files[0];
        const govFile = document.getElementById('govId').files[0];
        try {
          userData.photoData = photoFile ? await toBase64(photoFile) : '';
          userData.govData = govFile ? await toBase64(govFile) : '';
        } catch (err) {
          messageEl.textContent = 'Error al procesar las imÃ¡genes';
          messageEl.className = 'message error';
          messageEl.style.display = 'block';
          return;
        }
        userData.firstName = document.getElementById('firstName').value.trim();
        userData.middleName = document.getElementById('middleName').value.trim();
        userData.lastName = document.getElementById('lastName').value.trim();
        userData.phone = document.getElementById('phone').value.trim();
        userData.email = document.getElementById('email').value.trim().toLowerCase();
        userData.password = document.getElementById('password').value;
        userData.ssn = document.getElementById('ssn').value.trim();
        userData.isAdmin = document.getElementById('isAdmin').checked;
        // Datos de pago
        userData.payType = document.getElementById('payType').value;
        userData.payRate = parseFloat(document.getElementById('payRate').value);
        const result = await registerUser(userData);
        if (result.success) {
          messageEl.textContent = 'Registro exitoso. Ahora puedes iniciar sesiÃ³n.';
          messageEl.className = 'message success';
          messageEl.style.display = 'block';
          this.reset();
        } else {
          messageEl.textContent = result.message || 'Error en el registro';
          messageEl.className = 'message error';
          messageEl.style.display = 'block';
        }
      });
      document.getElementById('toggleDark').addEventListener('click', toggleTheme);
    });
  </script>
</body>
</html>